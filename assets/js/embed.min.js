$(function(){$("video").quickCastPlayer()}),function(e){e.fn.quickCastPlayer=function(){return/mobile/i.test(navigator.userAgent)?(e("video").css({"min-width":"100%",width:"100%",height:"auto"}),e("video").attr("controls",!0),void 0):this.each(function(){if(/chrome/i.test(navigator.userAgent)){var t=e(this).find("source[type='video/webm']");e(this).html("").append(t)}else{var t=e("video").find("source[type='video/mp4']");/-small.mp4/i.test(t[0].src)&&(t[0].src=t[0].src.replace("-small.mp4",".mp4"))}e(this)[0].load(),e(this)[0].addEventListener("loadeddata",function(){var t=e(this),n=t.attr("data-width"),s=t.attr("data-height"),i=t.attr("data-intro"),a=t.attr("data-outro"),r=!1;300>=n||300>=s?(r=!0,t.wrap('<div class="video micro"></div>')):t.wrap('<div class="video"></div>'),r===!1?(t.css({"min-width":"100%",width:"100%",height:"auto","max-width":n+"px"}),""!=i&&e(".play-button").append("<div><span>"+i+"</span></div>")):t.css({width:"100%",height:"auto","max-width":n+"px"});var o=t.parent(".video");e('<div class="play-button"></div><div class="player"><div class="pause-button"></div><div class="progress"><div class="progress-bar"><div class="progress-button"> </div></div></div><div class="time"><span class="ctime">00:00</span><span class="stime"> / </span><span class="ttime">00:00</span></div><div class="volume"><div class="volume-icon v-change-0"><span> </span></div></div><div class="fullscreen"><a href="#"> </a></div><div class="link"><a href="#"> </a></div></div>').appendTo(o),o.bind("selectstart",function(){return!1});var d,u=e(this)[0],l=u.duration,p=document.title,c=!1,f=!1,v=!1,m=!1,h=0,g=0,b=o.find(".progress").width(),y=function(){var t=u.buffered;if(o.find("[class^=buffered]").remove(),t.length>0)for(var n=t.length;n--;){$maxBuffer=t.end(n),$minBuffer=t.start(n);var s=100*($minBuffer/l),i=100*(($maxBuffer-$minBuffer)/l);e('<div class="buffered"></div>').css({left:s+"%",width:i+"%"}).appendTo(o.find(".progress"))}};y();var w=function(){var t=Math.round(e(".progress-bar").width()/b*l),n=u.currentTime,s=0,a=Math.floor(t/60),d=Math.floor(l/60),c=Math.round(l-60*d);t&&(s=Math.round(t)-60*a,s>59&&(s=Math.round(t)-60*a,60==s&&(a=Math.round(t/60),s=0))),g=n/l*b,10>s&&(s="0"+s),10>c&&(c="0"+c),o.find(".progress-bar").css({width:g+"px"});var f=g-o.find(".progress-button").width();0>f&&(f=0),o.find(".progress-button").css({left:f+"px"}),o.find(".ctime").html(a+":"+s),o.find(".ttime").html(d+":"+c),u.currentTime>0&&0==u.paused&&0==u.ended&&y(),document.title=v?"Playing "+a+":"+s+" / "+d+":"+c:u.currentTime>0?"Paused "+a+":"+s+" / "+d+":"+c:p,r===!1&&0>=n&&""!=i&&(0===e(".play-button div").length&&e(".play-button").append("<div><span></span></div>"),e(".play-button div span").text(i))};if(w(),u.addEventListener("timeupdate",w),e(".video").css("width","100%"),e(window).resize(function(){e(".video").css("width","100%"),u.currentTime>=l&&(u.currentTime=0),b=o.find(".progress").width(),w(),o.find(".progress-bar").css({width:g+"px"});var t=g-o.find(".progress-button").width();0>t&&(t=0),o.find(".progress-button").css({left:t+"px"}),y()}),r===!1)o.find(".player").css("opacity",1),setTimeout(function(){o.find(".player").css("opacity",0)},3e3);else{o.find(".player").css("display","none"),e(".play-button").append("<span></span>");var x=n/1.4;n>s&&(x=s/1.4),e(".play-button span").css("margin","-"+parseInt(x/2)+"px 0 0 -"+parseInt(x/2)+"px"),e(".play-button span").css({width:parseInt(x)+"px",height:parseInt(x)+"px"})}o.find(".play-button, .pause-button").on("click",function(){v=u.currentTime>0&&0==u.paused&&0==u.ended?!1:!0,0==v?(u.currentTime>0&&0==u.ended&&e(".play-button div").hide(),e(".play-button, .pause-button").removeClass("playing"),u.pause(),y()):(e(".play-button, .pause-button").addClass("playing"),m=!0,u.play())}),o.find(".progress").on("mousedown",function(e){c=!0,1==v&&u.pause(),h=e.pageX-o.find(".progress").offset().left,d=h/b*l,u.currentTime=d}),e("body, html").on("mousemove",function(t){var n=null;if(1!=r&&(o.on("mouseover",function(){clearTimeout(n),o.find(".player").css("opacity",1)}),o.on("mouseout",function(){n=setTimeout(function(){o.find(".player").css("opacity",0)},1e3)})),1==c){u.currentTime>0?e(".play-button div").hide(200):e(".play-button div").show(200),$draggingProgress=!0;var s=0;o.find(".progress-button").width(),h=t.pageX-o.find(".progress").offset().left,0>h?(s=0,u.currentTime=0):h>b?(u.currentTime=l,s=b):(s=h,d=h/b*l,u.currentTime=d),o.find(".progress-bar").css({width:s+"px"});var i=g-o.find(".progress-button").width();0>i&&(i=0),o.find(".progress-button").css({left:i+"px"})}}),u.addEventListener("ended",function(){v=!1,r===!1&&""!=a&&(0===e(".play-button div").length&&e(".play-button").append("<div><span></span></div>"),e(".play-button div span").text(a),e(".play-button div").show()),e(".play-button, .pause-button").removeClass("playing")}),o.find(".volume").on("click",function(){1==u.volume?(u.volume=0,o.find(".volume").addClass("off")):(u.volume=1,o.find(".volume").removeClass("off"))}),e("body, html").on("mouseup",function(){c=!1,f=!1,$draggingProgress=!1,1==v&&u.play(),y()}),u.requestFullscreen||u.mozRequestFullScreen||u.webkitRequestFullScreen||e(".fullscreen").hide(),e(".fullscreen").on("click",function(){u.requestFullscreen?u.requestFullscreen():u.mozRequestFullScreen?u.mozRequestFullScreen():u.webkitRequestFullScreen&&u.webkitRequestFullScreen()}),e(".link").on("click",function(){return window.parent.postMessage(window.location.href.replace("/embed/","/"),"*"),!1})})})}}(jQuery);
