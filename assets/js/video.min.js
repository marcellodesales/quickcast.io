$(function(){$("video").quickCastPlayer(),$("a.embed").on("click",function(){if(0===$("a.embed textarea").length){$("a.embed span").hide();var t=$(this).attr("data-width"),e=$(this).attr("data-height"),n=parseFloat(t/e);t>300&&e>300?$(this).append("<textarea><iframe name='quickcast' src='http://"+window.location.host+"/embed"+window.location.pathname+"' scrolling='no' frameborder='0' width='100%' allowfullscreen></iframe><script>!function(){function n(){var n=document.getElementsByName('quickcast')\nfor(var e in n){var t=n[e].offsetWidth\nn[e].height=t/"+n.toFixed(2)+"'px'}}n(),window.onresize=n,window.addEventListener('message',function(n){if(n.data.indexOf('//quick.as/') != -1)window.location.href=n.data},!1)}()\n</script></textarea>"):$(this).append("<textarea><iframe name='quickcast' src='http://"+window.location.host+"/embed"+window.location.pathname+"' scrolling='no' frameborder='0' width='"+t+"' height='"+e+"' allowfullscreen></iframe></textarea>")}return!1})}),function(t){t.fn.quickCastPlayer=function(){if(/mobile/i.test(navigator.userAgent)){var e=t("video").attr("data-width"),n=t("video").attr("data-height"),i=parseFloat(e/n);return t("video").attr("controls",!0).attr("width",window.screen.width).attr("height",window.screen.width/i.toFixed(2)),void 0}return this.each(function(){if(/chrome/i.test(navigator.userAgent)){var e=t(this).find("source[type='video/webm']");t(this).html("").append(e)}t(this)[0].load(),t(this)[0].addEventListener("loadeddata",function(){var e=t(this),n=e.attr("data-width"),i=e.attr("data-height"),a=e.attr("data-intro"),s=e.attr("data-outro"),r=!1;300>=n||300>=i?(r=!0,e.wrap('<div class="video micro"></div>')):e.wrap('<div class="video"></div>'),r===!1?(e.css({"min-width":"100%",width:"100%",height:"auto","max-width":n+"px"}),""!=a&&t(".play-button").append("<div><span>"+a+"</span></div>")):e.css({width:"100%",height:"auto","max-width":n+"px"});var o=e.parent(".video");t('<div class="play-button"></div><div class="player"><div class="pause-button"></div><div class="progress"><div class="progress-bar"><div class="progress-button"> </div></div></div><div class="time"><span class="ctime">00:00</span><span class="stime"> / </span><span class="ttime">00:00</span></div><div class="volume"><div class="volume-icon v-change-0"><span> </span></div></div><div class="fullscreen"><a href="#"> </a></div><div class="link"><a href="#"> </a></div></div>').appendTo(o),o.bind("selectstart",function(){return!1});var d,u=t(this)[0],l=u.duration,c=document.title,p=!1,f=!1,h=!1,v=!1,m=0,w=0,g=o.find(".progress").width(),b=function(){var e=u.buffered;if(o.find("[class^=buffered]").remove(),e.length>0)for(var n=e.length;n--;){$maxBuffer=e.end(n),$minBuffer=e.start(n);var i=100*($minBuffer/l),a=100*(($maxBuffer-$minBuffer)/l);t('<div class="buffered"></div>').css({left:i+"%",width:a+"%"}).appendTo(o.find(".progress"))}};b();var y=function(){var e=Math.round(t(".progress-bar").width()/g*l),n=u.currentTime,i=0,s=Math.floor(e/60),d=Math.floor(l/60),p=Math.round(l-60*d);e&&(i=Math.round(e)-60*s,i>59&&(i=Math.round(e)-60*s,60==i&&(s=Math.round(e/60),i=0))),w=n/l*g,10>i&&(i="0"+i),10>p&&(p="0"+p),o.find(".progress-bar").css({width:w+"px"});var f=w-o.find(".progress-button").width();0>f&&(f=0),o.find(".progress-button").css({left:f+"px"}),o.find(".ctime").html(s+":"+i),o.find(".ttime").html(d+":"+p),u.currentTime>0&&0==u.paused&&0==u.ended&&b(),document.title=h?"Playing "+s+":"+i+" / "+d+":"+p:u.currentTime>0?"Paused "+s+":"+i+" / "+d+":"+p:c,r===!1&&0>=n&&""!=a&&(0===t(".play-button div").length&&t(".play-button").append("<div><span></span></div>"),t(".play-button div span").text(a))};if(y(),u.addEventListener("timeupdate",y),t(".video").css("width","100%"),t(window).resize(function(){t(".video").css("width","100%"),u.currentTime>=l&&(u.currentTime=0),g=o.find(".progress").width(),y(),o.find(".progress-bar").css({width:w+"px"});var e=w-o.find(".progress-button").width();0>e&&(e=0),o.find(".progress-button").css({left:e+"px"}),b()}),r===!1)o.find(".player").css("opacity",1),setTimeout(function(){o.find(".player").css("opacity",0)},3e3);else{o.find(".player").css("display","none"),t(".play-button").append("<span></span>");var x=n/1.4;n>i&&(x=i/1.4),t(".play-button span").css("margin","-"+parseInt(x/2)+"px 0 0 -"+parseInt(x/2)+"px"),t(".play-button span").css({width:parseInt(x)+"px",height:parseInt(x)+"px"})}o.find(".play-button, .pause-button").on("click",function(){h=u.currentTime>0&&0==u.paused&&0==u.ended?!1:!0,0==h?(u.currentTime>0&&0==u.ended&&t(".play-button div").hide(),t(".play-button, .pause-button").removeClass("playing"),u.pause(),b()):(t(".play-button, .pause-button").addClass("playing"),v=!0,u.play())}),o.find(".progress").on("mousedown",function(t){p=!0,1==h&&u.pause(),m=t.pageX-o.find(".progress").offset().left,d=m/g*l,u.currentTime=d}),t("body, html").on("mousemove",function(e){var n=null;if(1!=r&&(o.on("mouseover",function(){clearTimeout(n),o.find(".player").css("opacity",1)}),o.on("mouseout",function(){n=setTimeout(function(){o.find(".player").css("opacity",0)},1e3)})),1==p){u.currentTime>0?t(".play-button div").hide(200):t(".play-button div").show(200),$draggingProgress=!0;var i=0;o.find(".progress-button").width(),m=e.pageX-o.find(".progress").offset().left,0>m?(i=0,u.currentTime=0):m>g?(u.currentTime=l,i=g):(i=m,d=m/g*l,u.currentTime=d),o.find(".progress-bar").css({width:i+"px"});var a=w-o.find(".progress-button").width();0>a&&(a=0),o.find(".progress-button").css({left:a+"px"})}}),u.addEventListener("ended",function(){h=!1,r===!1&&""!=s&&(0===t(".play-button div").length&&t(".play-button").append("<div><span></span></div>"),t(".play-button div span").text(s),t(".play-button div").show()),t(".play-button, .pause-button").removeClass("playing")}),o.find(".volume").on("click",function(){1==u.volume?(u.volume=0,o.find(".volume").addClass("off")):(u.volume=1,o.find(".volume").removeClass("off"))}),t("body, html").on("mouseup",function(){p=!1,f=!1,$draggingProgress=!1,1==h&&u.play(),b()}),u.requestFullscreen||u.mozRequestFullScreen||u.webkitRequestFullScreen||t(".fullscreen").hide(),t(".fullscreen").on("click",function(){u.requestFullscreen?u.requestFullscreen():u.mozRequestFullScreen?u.mozRequestFullScreen():u.webkitRequestFullScreen&&u.webkitRequestFullScreen()}),t(".link").on("click",function(){return window.location.href=window.location.href,!1})})})}}(jQuery);
